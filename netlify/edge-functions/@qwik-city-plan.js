import{c as h,i as r,b as v,S as P,u as j,d as b,e as k,f as e,g as i,h as _,j as d,k as z,l as p}from"./q-Bk-wXv9b.js";import I from"openai";import R from"spotify-web-api-node";import*as A from"dotenv";const M=async({cacheControl:l})=>{l({staleWhileRevalidate:604800,maxAge:5})},O=()=>v(P,null,3,"yB_0"),T=h(r(O,"s_VKFlAWJuVm8")),F=Object.freeze(Object.defineProperty({__proto__:null,default:T,onGet:M},Symbol.toStringTag,{value:"Module"})),L=l=>{const[n]=d();if(!l.type.startsWith("image/")){n.error="Please upload a selfie or photo of yourself";return}const t=new FileReader;t.onload=()=>{const s=t.result;n.imageData=s,n.error=""},t.onerror=()=>{n.error="Failed to read file"},t.readAsDataURL(l)},U=l=>{var o;const[n]=d();l.stopPropagation();const t=l.target,s=(o=t.files)==null?void 0:o[0];s&&(n(s),t.value="")},J=l=>{const[n]=d();l.stopPropagation(),l.preventDefault(),n.value&&n.value.click()},N=l=>{var s;const[n]=d();l.preventDefault(),l.stopPropagation();const t=(s=l.dataTransfer)==null?void 0:s.files[0];t&&n(t)},q=async l=>{const[n,t]=d();if(l.stopPropagation(),!t.imageData){t.error="Please upload a photo of yourself";return}if(!t.genre){t.error="Please select a music genre";return}t.isLoading=!0,t.error="";try{const s=await fetch("/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:t.imageData,genre:t.genre})});if(!s.ok)throw new Error("Failed to analyze mood and generate playlist");const o=await s.json();n("/results?"+new URLSearchParams({storyData:encodeURIComponent(JSON.stringify(o.storyData)),tracks:encodeURIComponent(JSON.stringify(o.tracks))}))}catch{t.error="Failed to analyze your mood"}finally{t.isLoading=!1}},Y=()=>{const l=j({imageData:"",genre:"",isLoading:!1,error:""}),n=b(),t=k(),s=r(L,"s_o4JNZ8C4VWQ",[l]),o=r(U,"s_lvvj22OjF1s",[s]),c=r(J,"s_I8mgr3j1pdc",[n]),m=r(N,"s_wx3ctJWIVLM",[s]),f=r(q,"s_T74Ipzq7J9s",[t,l]);return e("div",null,{class:"space-y-6","preventdefault:dragover":!0,onDrop$:m},[e("div",{class:`cursor-pointer rounded-lg border-2 border-dashed p-8 transition-colors hover:border-purple-400 ${l.imageData?"border-purple-500":"border-purple-500/50"}`},null,e("div",null,{class:"w-full h-full",onClick$:c},l.imageData?e("img",null,{src:i(a=>a.imageData,[l],"p0.imageData"),alt:"Preview",width:256,height:256,class:"mx-auto max-h-64 rounded-lg object-contain"},null,3,"4D_0"):e("div",null,{class:"text-center"},[e("div",null,{class:"mx-auto mb-4 h-12 w-12 text-purple-500"},e("svg",null,{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor"},[e("path",null,{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z"},null,3,null),e("path",null,{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z"},null,3,null)],3,null),3,null),e("p",null,{class:"mb-2 text-sm font-medium text-purple-500"},"Upload a photo of yourself",3,null),e("p",null,{class:"text-xs text-purple-500/70"},"Drag & drop or click to upload",3,null)],3,null),1,null),1,null),e("input",{ref:n},{type:"file",accept:"image/*",class:"hidden",onChange$:o},null,3,null),e("div",null,{class:"space-y-2"},[e("label",null,{class:"block text-sm font-medium text-purple-300"},"Select Music Genre",3,null),e("select",null,{class:"w-full rounded-lg bg-purple-950/50 p-2 text-white",value:i(a=>a.genre,[l],"p0.genre"),onChange$:_("s_U9uSCvgTavo",[l])},[e("option",null,{value:""},"Choose a genre",3,null),e("option",null,{value:"pop"},"Pop",3,null),e("option",null,{value:"rock"},"Rock",3,null),e("option",null,{value:"hip-hop"},"Hip Hop",3,null),e("option",null,{value:"jazz"},"Jazz",3,null),e("option",null,{value:"classical"},"Classical",3,null),e("option",null,{value:"electronic"},"Electronic",3,null),e("option",null,{value:"r&b"},"R&B",3,null)],3,null)],3,null),l.error&&e("p",null,{class:"text-center text-sm text-red-400"},i(a=>a.error,[l],"p0.error"),3,"4D_1"),e("button",null,{disabled:i(a=>a.isLoading,[l],"p0.isLoading"),class:"w-full rounded-lg bg-purple-600 px-4 py-2 font-medium text-white transition-colors hover:bg-purple-500 disabled:cursor-not-allowed disabled:opacity-50",onClick$:f},i(a=>a.isLoading?"Analyzing your mood...":"Analyze Mood & Create Playlist",[l],'p0.isLoading?"Analyzing your mood...":"Analyze Mood & Create Playlist"'),3,null)],1,"4D_2")},$=h(r(Y,"s_8tlt3U8t9Uo")),V=()=>e("div",null,{class:"min-h-screen bg-gradient-to-b from-purple-900 to-black text-white"},e("main",null,{class:"container mx-auto px-4 py-16"},e("div",null,{class:"text-center"},[e("h1",null,{class:"mb-6 bg-gradient-to-r from-purple-400 to-pink-600 bg-clip-text text-6xl font-bold text-transparent"},"MoodSync",3,null),e("p",null,{class:"mb-8 text-xl text-gray-300"},"Transform your moments into musical stories with AI",3,null),e("div",null,{class:"mx-auto max-w-2xl rounded-xl bg-white/10 p-8 shadow-2xl backdrop-blur-lg"},v($,null,3,"i8_0"),1,null),e("div",null,{class:"mt-12 text-sm text-gray-400"},e("p",null,null,"Powered by AI • Create unique musical experiences • Share your story",3,null),3,null)],1,null),1,null),1,"i8_1"),B=h(r(V,"s_B0lqk5IDDy4")),G={title:"MoodSync",meta:[{name:"description",content:"Qwik site description"}]},W=Object.freeze(Object.defineProperty({__proto__:null,default:B,head:G},Symbol.toStringTag,{value:"Module"}));A.config();const x=new I({apiKey:process.env.OPENAI_API_KEY}),y=new R({clientId:process.env.SPOTIFY_CLIENT_ID,clientSecret:process.env.SPOTIFY_CLIENT_SECRET}),E=async({json:l,parseBody:n})=>{var t,s;try{const o=await n(),{image:c,genre:m}=o,a=((t=(await x.chat.completions.create({model:"gpt-4o-mini",messages:[{role:"user",content:[{type:"text",text:"Analyze this selfie/portrait and determine the person's emotional state or mood. Focus on facial expressions, body language, and overall emotional context. Respond with a single word representing their primary mood from this list: happy, sad, energetic, calm, melancholic, excited, peaceful, anxious, confident, thoughtful."},{type:"image_url",image_url:{url:c,detail:"high"}}]}],max_tokens:50})).choices[0].message.content)==null?void 0:t.toLowerCase().trim())||"calm",w=(await x.chat.completions.create({model:"gpt-4o-mini",messages:[{role:"user",content:`Write a brief, friendly description analyzing the person's mood. Format: "After analyzing your photo, we can see that you appear to be in a ${a} mood. This was determined by [specific visual cues like facial expressions, posture, or other relevant details]. Based on this mood, we'll create a playlist that [brief explanation of how the music will match their mood]."`}]})).choices[0].message.content,D=await y.clientCredentialsGrant();y.setAccessToken(D.body.access_token);const S=`genre:${m} ${a}`,C=(s=(await y.searchTracks(S,{limit:10})).body.tracks)==null?void 0:s.items.map(u=>({id:u.id,name:u.name,artist:u.artists[0].name,album:u.album.name,duration_ms:u.duration_ms,preview_url:u.preview_url,external_url:u.external_urls.spotify}));l(200,{storyData:{mood:a,moodDescription:w,genre:m},tracks:C})}catch(o){console.error("Error:",o),l(500,{error:"Failed to process request"})}},Q=Object.freeze(Object.defineProperty({__proto__:null,onPost:E},Symbol.toStringTag,{value:"Module"})),K=new Map,H=async({params:l,json:n})=>{const{id:t}=l,s=K.get(t);if(!s){n(404,{error:"Result not found"});return}n(200,s)},Z=Object.freeze(Object.defineProperty({__proto__:null,onGet:H},Symbol.toStringTag,{value:"Module"})),X=()=>{const l=z(),n=b(),t=l.url.searchParams.get("storyData"),s=l.url.searchParams.get("tracks");if(t&&s)try{const o=JSON.parse(decodeURIComponent(t)),c=JSON.parse(decodeURIComponent(s));n.value={mood:o.mood,moodDescription:o.moodDescription,genre:o.genre,tracks:c}}catch(o){console.error("Failed to parse mood data:",o)}return e("div",null,{class:"min-h-screen bg-gradient-to-b from-purple-900 to-black text-white"},e("main",null,{class:"container mx-auto px-4 py-8"},n.value?e("div",null,{class:"max-w-4xl mx-auto space-y-12"},[e("div",null,{class:"text-center"},[e("h1",null,{class:"text-4xl font-bold mb-2"},"Your Mood Music",3,null),e("p",null,{class:"text-xl text-purple-300"},[i(o=>o.value.genre,[n],"p0.value.genre")," • ",i(o=>o.value.mood,[n],"p0.value.mood")],3,null)],3,null),e("div",null,{class:"bg-white/5 rounded-lg p-6"},[e("h2",null,{class:"text-2xl font-semibold mb-4"},"Mood Analysis",3,null),e("p",null,{class:"text-lg text-purple-200"},i(o=>o.value.moodDescription,[n],"p0.value.moodDescription"),3,null)],3,null),e("div",null,null,[e("h2",null,{class:"text-2xl font-semibold mb-6"},"Your Personalized Playlist",3,null),e("div",null,{class:"space-y-4"},n.value.tracks.map(o=>e("div",null,{class:"flex items-center justify-between bg-white/5 p-4 rounded-lg hover:bg-white/10 transition-colors"},[e("div",null,null,[e("h3",null,{class:"font-medium"},p(o,"name"),1,null),e("p",null,{class:"text-sm text-purple-300"},[p(o,"artist")," • ",p(o,"album")],1,null)],1,null),e("div",null,{class:"flex items-center space-x-4"},[o.preview_url&&e("audio",null,{controls:!0,class:"h-8"},e("source",{src:p(o,"preview_url")},{type:"audio/mpeg"},null,3,null),1,"cC_0"),e("a",{href:p(o,"external_url")},{target:"_blank",rel:"noopener noreferrer",class:"text-green-500 hover:text-green-400",title:"Open in Spotify"},e("svg",null,{class:"w-6 h-6",viewBox:"0 0 24 24",fill:"currentColor"},e("path",null,{d:"M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"},null,3,null),3,null),3,null)],1,null)],1,o.id)),1,null)],1,null),e("div",null,{class:"text-center"},e("button",null,{class:"bg-purple-600 px-6 py-2 rounded-lg hover:bg-purple-500 transition-colors",onClick$:_("s_b3QVC6ujeyU")},"Create Another Playlist",3,null),3,null)],1,"cC_1"):e("div",null,{class:"text-center text-red-400"},e("p",null,null,"No mood data found.",3,null),3,null),1,null),1,"cC_2")},ee=h(r(X,"s_nbnYDccyDeA")),le={title:"Your Mood Music - Results",meta:[{name:"description",content:"Your personalized mood-based music playlist"}]},te=Object.freeze(Object.defineProperty({__proto__:null,default:ee,head:le},Symbol.toStringTag,{value:"Module"})),oe=[],g=()=>F,ne=[["/",[g,()=>W],"/",["q-B-8dY5Gt.js","q-NagayurS.js"]],["api/generate/",[g,()=>Q],"/api/generate/",["q-B-8dY5Gt.js"]],["api/results/[id]/",[g,()=>Z],"/api/results/[id]/",["q-B-8dY5Gt.js"]],["results/",[g,()=>te],"/results/",["q-B-8dY5Gt.js","q-b2FuRUkN.js"]]],se=[],ae=!0,re="/",ie=!0,ge={routes:ne,serverPlugins:oe,menus:se,trailingSlash:ae,basePathname:re,cacheModules:ie};export{re as basePathname,ie as cacheModules,ge as default,se as menus,ne as routes,oe as serverPlugins,ae as trailingSlash};
